version: "3.8"

x-common-env: &common-env
  CYCLONEDDS_URI: |-
    <?xml version="1.0" encoding="utf-8"?>
    <CycloneDDS
        xmlns="https://cdds.io/config"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="https://cdds.io/config https://raw.githubusercontent.com/eclipse-cyclonedds/cyclonedds/master/etc/cyclonedds.xsd">
      <Domain>
        <General>
          <Interfaces>
            <!-- Adjust interface name to match your host (e.g. wlan0, eth0, enp3s0).
                 Consider removing this element entirely to let CycloneDDS auto-select. -->
            <NetworkInterface name="wlan0" priority="default" multicast="default"/>
            <!-- <NetworkInterface name="usb0" priority="default" multicast="default"/> -->
          </Interfaces>
          <DontRoute>true</DontRoute>
        </General>
      </Domain>
    </CycloneDDS>
  RMW_IMPLEMENTATION: rmw_cyclonedds_cpp
  ROS_DOMAIN_ID: "2"

services:
  turtlebot-navigation:
    image: turtlebot4_navigation:kilted
    container_name: ros2-turtlebot4-navigation-kilted
    tty: true
    build:
      context: ./
      dockerfile: Dockerfile
      args:
        ROS_DISTRO: kilted
    network_mode: host
    environment:
      <<: *common-env
      DISPLAY: ${DISPLAY}
      ROS_DISTRO: kilted
    volumes:
      - ../envs:/envs:ro
    command: >
      bash -lc
      "ros2 launch turtlebot4_navigation nav2.launch.py
       map:=/envs/philipp_home/map.yaml"

  turtlebot-localization:
    image: turtlebot4_navigation:kilted
    container_name: ros2-turtlebot4-localization-kilted
    tty: true
    build:
      context: ./
      dockerfile: Dockerfile
      args:
        ROS_DISTRO: kilted
    network_mode: host
    environment:
      <<: *common-env
      DISPLAY: ${DISPLAY}
      ROS_DISTRO: kilted
    volumes:
      - ../envs:/envs:ro
    command: >
      bash -lc
      "ros2 launch turtlebot4_navigation localization.launch.py
       map:=/envs/philipp_home/map.yaml"
